<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>MQ - Blog of JiayiY</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Blog of JiayiY"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Blog of JiayiY"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="消息队列顺序消费不同消息中间件的解决方案不同。 RocketMQ提供了MessageQueueSelector选择机制，可以使用SelectMessageQueueByHash，是同一个订单发送到 同一个队列中，再使用同步发送，只有同个订单的创建消息发送成功，再发送支付消息，即保证了发送有序。"><meta property="og:type" content="blog"><meta property="og:title" content="MQ"><meta property="og:url" content="http://yoursite.com/2020/07/07/MQ/"><meta property="og:site_name" content="Blog of JiayiY"><meta property="og:description" content="消息队列顺序消费不同消息中间件的解决方案不同。 RocketMQ提供了MessageQueueSelector选择机制，可以使用SelectMessageQueueByHash，是同一个订单发送到 同一个队列中，再使用同步发送，只有同个订单的创建消息发送成功，再发送支付消息，即保证了发送有序。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://yoursite.com/img/og_image.png"><meta property="article:published_time" content="2020-07-07T07:49:16.000Z"><meta property="article:modified_time" content="2020-09-18T08:40:33.554Z"><meta property="article:author" content="Jiayi Yang"><meta property="article:tag" content="MQ"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com/2020/07/07/MQ/"},"headline":"Blog of JiayiY","image":["http://yoursite.com/img/og_image.png"],"datePublished":"2020-07-07T07:49:16.000Z","dateModified":"2020-09-18T08:40:33.554Z","author":{"@type":"Person","name":"Jiayi Yang"},"description":"消息队列顺序消费不同消息中间件的解决方案不同。 RocketMQ提供了MessageQueueSelector选择机制，可以使用SelectMessageQueueByHash，是同一个订单发送到 同一个队列中，再使用同步发送，只有同个订单的创建消息发送成功，再发送支付消息，即保证了发送有序。"}</script><link rel="canonical" href="http://yoursite.com/2020/07/07/MQ/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/darcula.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Blog of JiayiY" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-07-07T07:49:16.000Z" title="2020-07-07T07:49:16.000Z">2020-07-07</time>发表</span><span class="level-item"><time dateTime="2020-09-18T08:40:33.554Z" title="2020-09-18T08:40:33.554Z">2020-09-18</time>更新</span><span class="level-item">20 分钟读完 (大约3066个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">MQ</h1><div class="content"><h1 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h1><h3 id="顺序消费"><a href="#顺序消费" class="headerlink" title="顺序消费"></a>顺序消费</h3><p>不同消息中间件的解决方案不同。</p>
<p>RocketMQ提供了MessageQueueSelector选择机制，可以使用SelectMessageQueueByHash，是同一个订单发送到 同一个队列中，再使用同步发送，只有同个订单的创建消息发送成功，再发送支付消息，即保证了发送有序。</p>
<a id="more"></a>

<h1 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h1><h2 id="如何保证消息的可靠性传输（如何处理消息的丢失问题）"><a href="#如何保证消息的可靠性传输（如何处理消息的丢失问题）" class="headerlink" title="如何保证消息的可靠性传输（如何处理消息的丢失问题）"></a>如何保证消息的可靠性传输（如何处理消息的丢失问题）</h2><ol>
<li><p>生产者丢了数据</p>
<ul>
<li><p>RabbitMQ的事务功能</p>
<p>生产者发送数据之前开启RabbitMQ事务（channel.txSelect），然后发送消息，如果消息没有成功被RabbitMQ接收到，那么生产者会收到异常报错，此时就可以回滚事务（channel.txRollback），然后重试发送消息；如果收到了消息，那么可以提交事务（channel.txCommit）。</p>
<p>缺点：吞吐量下降，太耗性能。</p>
</li>
<li><p>confirm机制</p>
<p>在生产者那里设置开启confirm模式之后，每次写的消息都会分配一个唯一的id，然后如果写入了RabbitMQ中，RabbitMQ会给你回传一个ack消息，告诉说这个消息ok了。如果RabbitMQ没能处理这个消息，会回调nack接口，告诉说这个消息接收失败，可以重试。而且可以结合这个机制自己在内存里维护每个消息id的状态，如果超过一定时间还没接收到这个消息的回调，那么可以重发。</p>
</li>
</ul>
<p>不同：事务机制是同步的，提交事务后会阻塞，但confirm机制是异步的，发送消息之后可以发送下一个消息，然后那个消息RabbitMQ接收了之后会异步回调接口通知你这个消息接收到了。</p>
<p>所以一般在生产者端避免数据丢失，都是用confirm机制的。</p>
</li>
<li><p>RabbitMQ丢失了数据</p>
<p>这个必须开启RabbitMQ的持久化，就是消息写入后会持久化到磁盘，RabbitMQ挂了，恢复之后会自动读取之前存储的数据，一般数据不会丢。除非极其罕见的是，RabbitMQ还没持久化就挂了，可能导致少量数据会丢失的，但概率较小。</p>
<p>设置持久化有两个步骤：</p>
<ul>
<li><p>创建queue的时候将其设置为持久化的，这样就可以保证RabbitMQ持久化queue的元数据，但是不会持久化queue里的数据；</p>
</li>
<li><p>发送消息时，将消息的deliveryMode设置为2，即将消息设置为持久化的，此时RabbitMQ就会将消息持久化到磁盘上去。</p>
<p>必须要同时设置这两个持久化才行，RabbitMQ哪怕是挂了，再次重启，也会从磁盘上重启恢复queue，恢复这个queue里的数据。</p>
</li>
</ul>
<p>而且持久化可以跟生产者那边的confirm机制配合起来，只有消息被持久化到磁盘之后，才会通知生产者ack了，所以哪怕是在持久化到磁盘之前，rabbitmq挂了，数据丢了，生产者收不到ack，也是可以自己重发的。</p>
</li>
<li><p>消费者丢了数据</p>
<p>刚消费到，还没处理，此时进程挂了，比如重启，RabbitMQ认为你都消费了，这数据就丢了。</p>
<p>这时用RabbitMQ提供的ack机制，简单来说，就是关闭RabbitMQ自动ack，可以通过一个api来调用就行，然后每次代码里确保处理完的时候，再程序里ack。这样的话，如果还没处理完，就没有ack，那RabbitMQ就认为还没处理完，这个时候RabbitMQ会把这个消费分配给别的consumer去处理，消息是不会丢的。</p>
</li>
</ol>
<h2 id="如何保证消息队列的高可用"><a href="#如何保证消息队列的高可用" class="headerlink" title="如何保证消息队列的高可用"></a>如何保证消息队列的高可用</h2><p>RabbitMQ有三种模式：单机模式，普通集群模式，镜像集群模式。</p>
<ol>
<li><p>单机模式</p>
<p>生产环境不会用到。</p>
</li>
<li><p>普通集群模式</p>
<p>多台机器上启动多个RabbitMQ实例，每个机器启动一个。但是创建的queue，只会放在一个RabbitMQ实例上，但是每个实例都同步queue的元数据。消费时，如果连接到了另一个实例，那么那个实例会从queue所在实例上拉取数据过来。</p>
<p>这方案主要是提高吞吐量的，就是说让集群中多个节点来服务某个queue的读写操作。</p>
</li>
<li><p>镜像集群模式</p>
<p>这种模式，才是所谓的RabbitMQ的高可用模式，跟普通集群模式不一样的是，创建的queue，无论元数据还是queue里的消息都会存在于多个实例上，每次写消息到queue的时候，都会自动把消息到多个实例的queue里进行消息同步。</p>
<p>缺点：性能开销较大，消息同步所有机器，导致网络带宽压力和消耗很重；扩展性较差。</p>
<p>RabbitMQ有很好的管理控制台，就是在后台新增一个策略，这个策略是镜像集群模式的策略，指定的时候可以要求数据同步到所有节点的，也可以要求就同步到指定数量的节点，然后你再次创建queue的时候，应用这个策略，就会自动将数据同步到其他的节点上去了。</p>
</li>
</ol>
<h2 id="如何保证消息不被重复消费（幂等性）"><a href="#如何保证消息不被重复消费（幂等性）" class="headerlink" title="如何保证消息不被重复消费（幂等性）"></a>如何保证消息不被重复消费（幂等性）</h2><ul>
<li>在消息生产时，MQ内部针对每条生产者发送的消息生成一个inner-msg-id，作为去重的依据（消息投递失败并重传），避免重复的消息进入队列；</li>
<li>在消息消费时，要求消息体中必须要有一个bizId（对于同一业务全局唯一，如支付ID、订单ID、帖子ID等）作为去重的依据，避免同一条消息被重复消费；</li>
</ul>
<p>当下游业务异常时，触发消息队列的重试机制，但存在多个服务在监听该消息队列，可能导致消息重复消费，需保证接口幂等性。</p>
<blockquote>
<p>幂等：同样的参数调用接口，结果都是一样的。</p>
</blockquote>
<ol>
<li><p>强校验</p>
<p>每次消息过来都要拿着订单号+业务场景这样的唯一标识去流水表查，看看有没有这条流水，有就直接return，没有就执行后面的逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span> <span class="params">(String orderId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">// 查询这个订单是否存在这个活动加GMV的流水</span></span><br><span class="line">        Object gmvFlow = getFlowByOrderId(<span class="string">&quot;addGmv&quot;</span> + orderId);</span><br><span class="line">        <span class="keyword">if</span>(Object.isNull(gmvFlow)) &#123;</span><br><span class="line">            <span class="comment">// 不存在流水，去加GMV和加流水 需放在一个事务中</span></span><br><span class="line">            addGmvAndFlow(orderId);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 存在流水证明加过了 直接返回</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 发送异常 触发消息队列的重试机制</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>弱校验</p>
<p>把这个id + 场景唯一标识，作为Redis的key，放到缓存里面（失效时间看场景），一定时间内的这个消息就去Redis判断。</p>
</li>
</ol>
<h2 id="如何保证消息的顺序性"><a href="#如何保证消息的顺序性" class="headerlink" title="如何保证消息的顺序性"></a>如何保证消息的顺序性</h2><h2 id="消息积压"><a href="#消息积压" class="headerlink" title="消息积压"></a>消息积压</h2><ol>
<li><p>大量消息在MQ里积压了几小时还没解决</p>
<p>一般这个时候，只能操作临时紧急扩容了，具体操作步骤和思路如下：</p>
<p>1）先修复consumer的问题，确保其恢复消费速度，然后将现有consumer都停掉；</p>
<p>2）新建一个topic，partition是原来的10倍，临时建立好原先10倍或者20倍的queue数量；</p>
<p>3）然后写一个临时的分发数据的consumer程序，这个程序部署上去消费积压的数据，消费之后不做耗时的处理，直接均匀轮询写入临时建立好的10倍数量的queue；</p>
<p>4）接着临时征用10倍的机器来部署consumer，每一批consumer消费一个临时queue的数据；</p>
<p>5）这种做法相当于是临时将queue资源和consumer资源扩大10倍，以正常的10倍速度来消费数据；</p>
<p>6）等快速消费完积压数据之后，得恢复原先部署架构，重新用原先的consumer机器来消费消息；</p>
</li>
<li><p>设置了过期时间</p>
<p>这个情况下，实际上没啥积压，而是丢了大量的消息。可以采取批量重导，大量积压时，直接丢弃数据，然后等过了高峰期以后，将丢失的那批数据，写个临时程序，一点一点的查出来，然后重新灌入MQ里面去，把白天丢的数据给他补回来。</p>
<p>假设1万个订单积压在MQ里面，没有处理，其中1000个订单都丢了，你只能手动写程序把那1000个订单给查出来，手动发到MQ里去再补一次。</p>
</li>
</ol>
<h2 id="死信队列"><a href="#死信队列" class="headerlink" title="死信队列"></a>死信队列</h2><p>DLX，全称为 Dead-Letter-Exchange，当消息在一个队列中变成死信 (dead message) 之后，它能被重新被发送到另一个交换器中，这个交换器就是 DLX，绑定 DLX 的队列就称之为死信队列。<br>DLX 也是一个正常的交换器，和一般的交换器没有区别，它能在任何的队列上被指定， 实际上就是设置某个队列的属性。当这个队列中存在死信时，RabbitMQ 就会自动地将这个消息重新发布到设置的 DLX 上去，进而被路由到另一个队列，即死信队列。</p>
<h2 id="延迟队列"><a href="#延迟队列" class="headerlink" title="延迟队列"></a>延迟队列</h2><p>延迟队列存储的对象是对应的延迟消息，所谓“延迟消息”是指当消息被发送后，并不想让消费者立刻拿到消息，而是等待特定时间后，消费者才能拿到这个消息进行消费</p>
<p>应用场景：订单系统，用延迟队列处理超时订单；用户希望通过手机远程遥控家里的智能设备在指定的时间进行工作。这时候就可以将用户指令发送到延迟队列，当指令设定的时间到了再将指令推送到智能设备。<br>持久化？</p>
<h2 id="使用RabbitMQ的场景"><a href="#使用RabbitMQ的场景" class="headerlink" title="使用RabbitMQ的场景"></a>使用RabbitMQ的场景</h2><p>服务间异步通信，顺序消费，定时任务，请求削峰</p>
<h2 id="消息如何路由"><a href="#消息如何路由" class="headerlink" title="消息如何路由"></a>消息如何路由</h2><p>消息提供方 -&gt; 路由 -&gt; 一至多个队列<br>消息发布到交换器时，消息将拥有一个路由键（routing key），在消息创建时设定。</p>
<p>通过binding key将Exchange和Queue链接在一起；<br>消息到达交换器后，RabbitMQ会将消息的路由键与队列的路由键进行匹配（针对不同的交换器有不同的路由规则），常用的Exchange主要分为一下三种：<br>fanout：它会把所有发送到该Exchange的消息路由到所有与它绑定的Queue中；<br>direct：它会把消息路由到那些binding key与routing key完全匹配的Queue中；<br>topic：可以通过通配符满足一部分规则就可以传送。它的约定是：</p>
<ul>
<li>routing key为一个句点号“. ”分隔的字符串（我们将被句点号“. ”分隔开的每一段独立的字符串称为一个单词），“stock.usd.nyse”、“nyse.vmw”、“quick.orange.rabbit”；</li>
<li>binding key与routing key一样也是句点号“. ”分隔的字符串；</li>
<li>binding key中可以存在两种特殊字符“ * ”与“#”，用于做模糊匹配，其中“ * ”用于匹配一个单词，“#”用于匹配多个单词（可以是零个）；</li>
</ul>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css"></div><div class="article-licensing box"><div class="licensing-title"><p>MQ</p><p><a href="http://yoursite.com/2020/07/07/MQ/">http://yoursite.com/2020/07/07/MQ/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Jiayi Yang</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-07-07</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2020-09-18</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/MQ/">MQ</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/07/07/MySQL/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">MySQL</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/07/06/Lcof25/"><span class="level-item">Lcof25</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "EUMJSoVQNU9husSvEa2sjwgu-gzGzoHsz",
            appKey: "cIlIfJdKwlBAIbyYgLpDc1WT",
            
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#消息队列"><span class="level-left"><span class="level-item">1</span><span class="level-item">消息队列</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#顺序消费"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">顺序消费</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#RabbitMQ"><span class="level-left"><span class="level-item">2</span><span class="level-item">RabbitMQ</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#如何保证消息的可靠性传输（如何处理消息的丢失问题）"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">如何保证消息的可靠性传输（如何处理消息的丢失问题）</span></span></a></li><li><a class="level is-mobile" href="#如何保证消息队列的高可用"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">如何保证消息队列的高可用</span></span></a></li><li><a class="level is-mobile" href="#如何保证消息不被重复消费（幂等性）"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">如何保证消息不被重复消费（幂等性）</span></span></a></li><li><a class="level is-mobile" href="#如何保证消息的顺序性"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">如何保证消息的顺序性</span></span></a></li><li><a class="level is-mobile" href="#消息积压"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">消息积压</span></span></a></li><li><a class="level is-mobile" href="#死信队列"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">死信队列</span></span></a></li><li><a class="level is-mobile" href="#延迟队列"><span class="level-left"><span class="level-item">2.7</span><span class="level-item">延迟队列</span></span></a></li><li><a class="level is-mobile" href="#使用RabbitMQ的场景"><span class="level-left"><span class="level-item">2.8</span><span class="level-item">使用RabbitMQ的场景</span></span></a></li><li><a class="level is-mobile" href="#消息如何路由"><span class="level-left"><span class="level-item">2.9</span><span class="level-item">消息如何路由</span></span></a></li></ul></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/2.png" alt="Jiayi Yang"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Jiayi Yang</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Hangzhou, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">51</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">18</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/JiayiY" target="_blank" rel="noopener">关注我</a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"><span class="level-start"><span class="level-item">分布式</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%89%91%E6%8C%87offer/"><span class="level-start"><span class="level-item">剑指offer</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B9%B6%E5%8F%91/"><span class="level-start"><span class="level-item">并发</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%A1%B9%E7%9B%AE/"><span class="level-start"><span class="level-item">项目</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-09-29T11:42:04.000Z">2020-09-29</time></p><p class="title"><a href="/2020/09/29/IMPROMPTU/">IMPROMPTU</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-09-27T04:56:57.000Z">2020-09-27</time></p><p class="title"><a href="/2020/09/27/spring-refresh/">spring_refresh</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-09-01T04:44:18.000Z">2020-09-01</time></p><p class="title"><a href="/2020/09/01/spring-ioc/">spring_ioc</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-08-25T05:07:41.000Z">2020-08-25</time></p><p class="title"><a href="/2020/08/25/Shiro/">Shiro</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-08-09T01:48:59.000Z">2020-08-09</time></p><p class="title"><a href="/2020/08/09/SeckillThinking/">SeckillThinking</a></p><p class="categories"><a href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Basis/"><span class="tag">Basis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Book/"><span class="tag">Book</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Database/"><span class="tag">Database</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Distribution/"><span class="tag">Distribution</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dubbo/"><span class="tag">Dubbo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Framework/"><span class="tag">Framework</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JVM/"><span class="tag">JVM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Log/"><span class="tag">Log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MQ/"><span class="tag">MQ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Project/"><span class="tag">Project</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring/"><span class="tag">Spring</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/concurrent/"><span class="tag">concurrent</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dp/"><span class="tag">dp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lc/"><span class="tag">lc</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lcof/"><span class="tag">lcof</span><span class="tag">16</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Blog of JiayiY" height="28"></a><p class="is-size-7"><span>&copy; 2020 Jiayi Yang</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>